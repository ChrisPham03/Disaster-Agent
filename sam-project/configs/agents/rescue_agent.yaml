# Solace Agent Mesh Rescue Agent Configuration
# FIXED: Using correct SAM tool configuration format

log:
  stdout_log_level: INFO
  log_file_level: DEBUG
  log_file: rescue-agent.log

!include ../shared_config.yaml

apps:
  - name: rescue-agent_app
    app_base_path: .
    app_module: solace_agent_mesh.agent.sac.app
    
    broker:
      <<: *broker_connection

    app_config:
      namespace: ${NAMESPACE}
      supports_streaming: true
      agent_name: "RescueAgent"
      display_name: "Rescue Coordinator"
      model: *general_model
      
      instruction: |
        You are the Rescue Coordination Agent. Your responsibilities:
        
        1. RECEIVE VICTIM REPORTS:
           - Accept victim reports from Master Agent
           - Parse location, severity, and victim count
           - Identify scenario type (building_collapse, flood, fire, medical, general)
        
        2. CALCULATE REQUIREMENTS:
           - Determine scenario type based on conditions
           - Calculate equipment needed using calculate_equipment tool
           - Calculate personnel using calculate_personnel tool
        
        3. REQUEST RESOURCES:
           - Send equipment request to Resource Agent
           - Handle partial allocations gracefully
           - Adjust plans if resources unavailable
        
        4. COORDINATE DEPLOYMENT:
           - Generate route to victim location using get_route tool
           - Assign team and equipment
           - Provide deployment instructions with ETA
        
        Scenario Type Detection:
           - "structural_collapse" condition → building_collapse
           - "flooding" condition → flood
           - "fire_hazard" condition → fire
           - Injuries without hazards → medical
           - Default → general
        
        Always prioritize CRITICAL victims.
        Confirm resource availability before finalizing assignments.
      
      inject_system_purpose: true
      inject_response_format: true
      
      session_service:
        type: "memory"
        default_behavior: "PERSISTENT"
      
      artifact_service: *default_artifact_service
      
      tools:
        # Built-in artifact management tools
        - tool_type: builtin-group
          group_name: artifact_management
        
        # Python tool: Calculate Equipment
        - tool_type: python
          component_module: modules.rescue_tools.tools_calculator
          component_base_path: .
          function_name: calculate_equipment
          tool_name: calculate_equipment
          tool_config: {}
        
        # Python tool: Calculate Personnel
        - tool_type: python
          component_module: modules.rescue_tools.personnel_calc
          component_base_path: .
          function_name: calculate_personnel
          tool_name: calculate_personnel
          tool_config: {}
        
        # Python tool: Get Route
        - tool_type: python
          component_module: modules.rescue_tools.navigation
          component_base_path: .
          function_name: get_route
          tool_name: get_route
          tool_config: {}
        
        # Python tool: Estimate Arrival Time
        - tool_type: python
          component_module: modules.rescue_tools.navigation
          component_base_path: .
          function_name: estimate_arrival_time
          tool_name: estimate_arrival_time
          tool_config: {}

      agent_card:
        description: "Coordinates rescue teams, equipment, and personnel for disaster response operations."
        defaultInputModes: [text]
        defaultOutputModes: [text]
        skills:
          - id: calculate_equipment
            name: Equipment Calculator
            description: Calculate required equipment based on rescue scenario type, number of victims, and severity.
          
          - id: calculate_personnel
            name: Personnel Calculator
            description: Calculate minimum and recommended personnel for rescue operations.
          
          - id: get_route
            name: Route Planner
            description: Get optimal route to victim location with hazard avoidance.
          
          - id: estimate_arrival_time
            name: ETA Calculator
            description: Estimate arrival time based on distance and traffic conditions.

      agent_card_publishing:
        interval_seconds: 10
      
      agent_discovery:
        enabled: true
      
      inter_agent_communication:
        allow_list: ["*"]
        request_timeout_seconds: 300