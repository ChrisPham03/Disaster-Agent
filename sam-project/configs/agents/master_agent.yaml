# Solace Agent Mesh Master Agent Configuration
# FIXED: Using correct SAM tool configuration format

log:
  stdout_log_level: INFO
  log_file_level: DEBUG
  log_file: master-agent.log

!include ../shared_config.yaml

apps:
  - name: master-agent_app
    app_base_path: .
    app_module: solace_agent_mesh.agent.sac.app
    
    broker:
      <<: *broker_connection

    app_config:
      namespace: ${NAMESPACE}
      supports_streaming: true
      agent_name: "MasterAgent"
      display_name: "Disaster Triage Master"
      model: *general_model
      
      instruction: |
        You are the Master Disaster Rescue Agent. Your responsibilities:
        
        1. VICTIM COMMUNICATION:
           - Communicate calmly and empathetically with victims
           - Ask clear questions to gather: location, number of people, injuries, hazards
           - Provide reassurance while extracting details
        
        2. INFORMATION EXTRACTION:
           - Location: Get GPS coordinates or detailed address
           - Severity: Assess as CRITICAL, MODERATE, or STABLE
           - Headcount: Number of people needing rescue
           - Conditions: Injuries, fire, flood, collapse hazards
        
        3. PRIORITIZATION (use calculate_priority tool):
           - CRITICAL (70-100): Life-threatening, immediate danger
           - HIGH (40-69): Serious but not immediately life-threatening
           - MEDIUM (20-39): Needs attention but stable
           - LOW (0-19): Minor assistance needed
        
        4. HANDOFF:
           - After gathering info, create victim report
           - Delegate to Rescue Agent for team assignment
        
        Always maintain calm, professional tone in crisis situations.
      
      inject_system_purpose: true
      inject_response_format: true
      
      session_service:
        type: "memory"
        default_behavior: "PERSISTENT"
      
      artifact_service: *default_artifact_service
      
      tools:
        # Built-in artifact management tools
        - tool_type: builtin-group
          group_name: artifact_management
        
        # Python tool: Extract Location
        - tool_type: python
          component_module: modules.master_tools.location_utils
          component_base_path: .
          function_name: extract_location
          tool_name: extract_location
          tool_config: {}
        
        # Python tool: Calculate Priority
        - tool_type: python
          component_module: modules.master_tools.prioritizer
          component_base_path: .
          function_name: calculate_priority
          tool_name: calculate_priority
          tool_config: {}
        
        # Python tool: Create Victim Report
        - tool_type: python
          component_module: modules.master_tools.victim_chat
          component_base_path: .
          function_name: create_victim_report
          tool_name: create_victim_report
          tool_config: {}

      agent_card:
        description: "Primary agent for victim communication and rescue prioritization. Communicates with disaster victims, extracts critical information, and prioritizes rescue operations."
        defaultInputModes: [text]
        defaultOutputModes: [text]
        skills:
          - id: extract_location
            name: Location Extractor
            description: Extract and validate location information from victim input including GPS coordinates and addresses.
          
          - id: calculate_priority
            name: Priority Calculator
            description: Calculate victim priority score (0-100) based on severity, people count, injuries, and hazard factors.
          
          - id: create_victim_report
            name: Victim Report Creator
            description: Create standardized victim report for rescue team handoff with all extracted information.

      agent_card_publishing:
        interval_seconds: 10
      
      agent_discovery:
        enabled: true
      
      inter_agent_communication:
        allow_list: ["*"]
        request_timeout_seconds: 300